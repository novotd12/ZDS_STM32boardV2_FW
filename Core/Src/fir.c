#include "fir.h"

#define MAX_TAPS  501
volatile int32_t fir_buffer[MAX_TAPS];
volatile int32_t fir_coef[MAX_TAPS]={
		321,
		-20,
		-20,
		-21,
		-23,
		-25,
		-27,
		-31,
		-34,
		-38,
		-42,
		-47,
		-52,
		-57,
		-63,
		-68,
		-74,
		-80,
		-86,
		-93,
		-99,
		-105,
		-111,
		-117,
		-123,
		-128,
		-133,
		-138,
		-142,
		-146,
		-149,
		-152,
		-154,
		-155,
		-156,
		-156,
		-154,
		-152,
		-149,
		-145,
		-140,
		-133,
		-126,
		-117,
		-107,
		-95,
		-83,
		-69,
		-53,
		-37,
		-19,
		1,
		22,
		44,
		67,
		92,
		118,
		145,
		174,
		203,
		234,
		266,
		299,
		332,
		367,
		402,
		438,
		475,
		512,
		549,
		587,
		625,
		663,
		702,
		740,
		777,
		815,
		852,
		888,
		924,
		959,
		993,
		1026,
		1058,
		1089,
		1118,
		1146,
		1173,
		1198,
		1221,
		1242,
		1262,
		1280,
		1296,
		1310,
		1321,
		1331,
		1339,
		1344,
		1347,
		1349,
		1347,
		1344,
		1339,
		1331,
		1321,
		1310,
		1296,
		1280,
		1262,
		1242,
		1221,
		1198,
		1173,
		1146,
		1118,
		1089,
		1058,
		1026,
		993,
		959,
		924,
		888,
		852,
		815,
		777,
		740,
		702,
		663,
		625,
		587,
		549,
		512,
		475,
		438,
		402,
		367,
		332,
		299,
		266,
		234,
		203,
		174,
		145,
		118,
		92,
		67,
		44,
		22,
		1,
		-19,
		-37,
		-53,
		-69,
		-83,
		-95,
		-107,
		-117,
		-126,
		-133,
		-140,
		-145,
		-149,
		-152,
		-154,
		-156,
		-156,
		-155,
		-154,
		-152,
		-149,
		-146,
		-142,
		-138,
		-133,
		-128,
		-123,
		-117,
		-111,
		-105,
		-99,
		-93,
		-86,
		-80,
		-74,
		-68,
		-63,
		-57,
		-52,
		-47,
		-42,
		-38,
		-34,
		-31,
		-27,
		-25,
		-23,
		-21,
		-20,
		-20,
		 321
};
volatile int16_t Ntaps = 201;

void setNtaps(int16_t taps){
	Ntaps = taps;
}
void setCoefs(int16_t n, int32_t val){
	fir_coef[n] = val;
}

int32_t updateFIR(int32_t val){
	int16_t q;
	for (q = (Ntaps - 2); q >= 0; q--) {
		fir_buffer[q + 1] = fir_buffer[q];
	}
	fir_buffer[0] = val;

	int32_t fir_out = 0;

	for (q = 0; q < Ntaps; q++) {
		fir_out += (fir_coef[q] * fir_buffer[q])>>16;
	}
	return fir_out;
}
